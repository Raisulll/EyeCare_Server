INSERT INTO TRANSACTION (
  TRANSACTION_DATE,
  TRANSACTION_AMOUNT,
  PATIENT_ID,
  DOCTOR_ID
) VALUES(
  (SELECT APPOINTMENT_DATE FROM APPOINTMENT WHERE APPOINTMENT_ID = 26),
  (SELECT DOCTOR_PAYMENT FROM DOCTOR WHERE DOCTOR_ID = (SELECT DOCTOR_ID FROM APPOINTMENT WHERE APPOINTMENT_ID = 26)),
  (SELECT PATIENT_ID FROM APPOINTMENT WHERE APPOINTMENT_ID = 26),
  (SELECT DOCTOR_ID FROM APPOINTMENT WHERE APPOINTMENT_ID = 26)
);

SELECT
  DOCTOR_ID
FROM
  APPOINTMENT
WHERE
  APPOINTMENT_ID = 26;

SELECT
  *
FROM
  APPOINTMENT;

ALTER TABLE TRANSACTION RENAME COLUMN DOCTTOR_ID TO DOCTOR_ID;

SELECT
  *
FROM
  TRANSACTION;

SELECT
  *
FROM
  DOCTOR;

ALTER TABLE TRANSACTION
  ADD TRANSACTION_FOR VARCHAR(
    255
  ) DEFAULT 'Doctors fee' NOT NULL;

ALTER TABLE TRANSACTION DROP COLUMN TRANSACTION_FOR;

SELECT
  *
FROM
  TRANSACTION;

ALTER TABLE TRANSACTION
  ADD PAYMENT_TO VARCHAR(
    255
  ) DEFAULT 'Doctors/Shop' NOT NULL;

ALTER TABLE DOCTOR DROP COLUMN HOSPITAL_ID;

ALTER TABLE APPOINTMENT
  ADD HOSPITAL_ID NUMBER DEFAULT 3 NOT NULL;

SELECT
  *
FROM
  APPOINTMENT;

ALTER TABLE PRESCRIPTION DROP COLUMN SURGERY;

ALTER TABLE PRESCRIPTION
  ADD SURGERY VARCHAR(
    255
  ) DEFAULT 'No';

ALTER TABLE APPOINTMENT
  ADD PRESCRIPTION_ID NUMBER;

UPDATE APPOINTMENT
SET
  APPOINTMENT_STATUS='Completed',
  PRESCRIPTION_ID= (
    SELECT
      PRESCRIPTION_ID
    FROM
      PRESCRIPTION
    WHERE
      APPOINTMENT_ID=26
  )
WHERE
  APPOINTMENT_ID=26;

SELECT
  *
FROM
  HOSPITAL;

ALTER TABLE DOCTOR
  ADD HOSPITAL_ID NUMBER DEFAULT 3 NOT NULL;

DROP TABLE PRODUCT;

DROP TABLE INVENTORY;

DROP TABLE ORDERS;

DROP TABLE DELIVERY;

DROP TABLE PAYMENT;

COMMIT;

CREATE TABLE INVENTORY(
  SHOP_ID NUMBER NOT NULL,
  PRODUCT_ID NUMBER NOT NULL,
  PRODUCT_QUANTITY NUMBER NOT NULL,
  CONSTRAINT INVENTORY_PK PRIMARY KEY (SHOP_ID, PRODUCT_ID),
  CONSTRAINT INVENTORY_FK1 FOREIGN KEY (SHOP_ID) REFERENCES SHOP(SHOP_ID),
  CONSTRAINT INVENTORY_FK2 FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCT(PRODUCT_ID)
);

CREATE TABLE PRODUCT (
  PRODUCT_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
  PRODUCT_NAME VARCHAR(255) NOT NULL,
  PRODUCT_PRICE NUMBER NOT NULL,
  PRODUCT_DESCRIPTION VARCHAR(255) NOT NULL,
  PRODUCT_IMAGE VARCHAR(255) NOT NULL,
  CONSTRAINT PRODUCT_PK PRIMARY KEY (PRODUCT_ID)
);

ALTER TABLE SUPPLY DROP COLUMN PRODUCT_IMAGE;

ALTER TABLE SUPPLY
  ADD PRODUCT_IMAGE VARCHAR(
    255
  ) DEFAULT 'E:\React Sikhbo\DBMS_Project\client\src\Assets\images\glass.png' NOT NULL;

SELECT
  *
FROM
  SHOP;

ALTER TABLE INVENTORY DROP COLUMN PRODUCT_QUANTITY;

DROP TABLE PRODUCT;

DROP TABLE INVENTORY;

CREATE TABLE INVENTORY(
  SHOP_ID NUMBER NOT NULL,
  PRODUCT_ID NUMBER NOT NULL,
  CONSTRAINT INVENTORY_PK PRIMARY KEY (SHOP_ID, PRODUCT_ID),
  CONSTRAINT INVENTORY_FK1 FOREIGN KEY (SHOP_ID) REFERENCES SHOP(SHOP_ID),
  CONSTRAINT INVENTORY_FK2 FOREIGN KEY (PRODUCT_ID) REFERENCES SUPPLY(PRODUCT_ID)
);

CREATE TABLE SUPPLY (
  PRODUCT_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
  PRODUCT_NAME VARCHAR(255) NOT NULL,
  PRODUCT_PRICE NUMBER NOT NULL,
  PRODUCT_DESCRIPTION VARCHAR(255) NOT NULL,
  PRODUCT_IMAGE VARCHAR(255) NOT NULL,
  CONSTRAINT PRODUCT_PK PRIMARY KEY (PRODUCT_ID)
);

ALTER TABLE INVENTORY
  ADD QUANTITY NUMBER DEFAULT 0 NOT NULL;

SELECT
  PRODUCT_NAME,
  PRODUCT_DESCRIPTION,
  PRODUCT_PRICE,
  QUANTITY
FROM
  SUPPLY    S,
  INVENTORY I
WHERE
  S.PRODUCT_ID = I.PRODUCT_ID;

SELECT
  *
FROM
  INVENTORY;

CREATE TABLE CART(
  PATIENT_ID NUMBER NOT NULL,
  PRODUCT_ID NUMBER NOT NULL,
  SHOP_ID NUMBER NOT NULL,
  CONSTRAINT CART_PK PRIMARY KEY (PATIENT_ID, PRODUCT_ID, SHOP_ID),
  CONSTRAINT CART_FK1 FOREIGN KEY (PATIENT_ID) REFERENCES PATIENT(PATIENT_ID),
  CONSTRAINT CART_FK2 FOREIGN KEY (PRODUCT_ID) REFERENCES SUPPLY(PRODUCT_ID),
  CONSTRAINT CART_FK3 FOREIGN KEY (SHOP_ID) REFERENCES SHOP(SHOP_ID)
);

SELECT
  *
FROM
  CART;

ALTER TABLE CART
  ADD CART_QUANTITY NUMBER DEFAULT 0 NOT NULL;

CREATE TABLE ORDERS(
  ORDER_ID NUMBER,
  PATIENT_ID NUMBER NOT NULL,
  PRODUCT_ID NUMBER NOT NULL,
  SHOP_ID NUMBER NOT NULL,
  ORDER_DATE DATE DEFAULT SYSDATE NOT NULL,
  ORDER_QUANTITY NUMBER NOT NULL,
  ORDER_STATUS VARCHAR(255) DEFAULT 'Confirmed' NOT NULL,
  CONSTRAINT ORDERS_PK PRIMARY KEY (ORDER_ID),
  CONSTRAINT ORDERS_FK1 FOREIGN KEY (PATIENT_ID) REFERENCES PATIENT(PATIENT_ID),
  CONSTRAINT ORDERS_FK2 FOREIGN KEY (PRODUCT_ID) REFERENCES SUPPLY(PRODUCT_ID),
  CONSTRAINT ORDERS_FK3 FOREIGN KEY (SHOP_ID) REFERENCES SHOP(SHOP_ID)
);

CREATE TABLE DELIVERY_AGENCY(
  DELIVERY_AGENCY_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
  DELIVERY_AGENCY_NAME VARCHAR(255) NOT NULL,
  DELIVERY_AGENCY_PHONE VARCHAR(11) NOT NULL,
  DELIVERY_AGENCY_EMAIL VARCHAR(255) NOT NULL,
  DELIVERY_CHARGE NUMBER DEFAULT 0 NOT NULL,
  DELIVERY_AGENCY_DISTRICT VARCHAR(255) NOT NULL,
  DELIVERY_AGENCY_AREA VARCHAR(255) NOT NULL,
  DELIVERY_AGENCY_ROADNUMBER VARCHAR(255) NOT NULL,
  DELIVERY_AGENCY_LICENSE VARCHAR(255) NOT NULL,
  DELIVERY_AGENCY_STATUS VARCHAR(255) NOT NULL,
  DELIVERY_AGENCY_PASSWORD VARCHAR(255) NOT NULL,
  CONSTRAINT DELIVERY_AGENCY_PK PRIMARY KEY (DELIVERY_AGENCY_ID),
  CONSTRAINT DELIVERY_AGENCY_PHONE_CHECK CHECK (LENGTH(DELIVERY_AGENCY_PHONE) = 11)
);

ALTER TABLE DELIVERY_AGENCY ADD;

SELECT
  *
FROM
  SHOP;

SELECT
  *
FROM
  APPOINTMENT;

ALTER TABLE ORDERS
  ADD ORDER_STATUS VARCHAR(
    255
  ) DEFAULT 'Pending' NOT NULL;

CREATE TABLE ORDERED_PRODUCTS(
  ORDER_ID NUMBER NOT NULL,
  PRODUCT_ID NUMBER NOT NULL,
  SHOP_ID NUMBER NOT NULL,
  ORDER_QUANTITY NUMBER NOT NULL,
  CONSTRAINT ORDERED_PRODUCTS_PK PRIMARY KEY (ORDER_ID, PRODUCT_ID, SHOP_ID),
  CONSTRAINT ORDERED_PRODUCTS_FK1 FOREIGN KEY (ORDER_ID) REFERENCES ORDERS(ORDER_ID),
  CONSTRAINT ORDERED_PRODUCTS_FK2 FOREIGN KEY (PRODUCT_ID) REFERENCES SUPPLY(PRODUCT_ID),
  CONSTRAINT ORDERED_PRODUCTS_FK3 FOREIGN KEY (SHOP_ID) REFERENCES SHOP(SHOP_ID)
);

ALTER TABLE ORDERS DROP COLUMN PRODUCT_ID;

ALTER TABLE ORDERS DROP COLUMN SHOP_ID;

ALTER TABLE ORDERS DROP COLUMN ORDER_QUANTITY;

ALTER TABLE ORDERS
  ADD DELIVERY_AGENCY_ID NUMBER NOT NULL;

ALTER TABLE ORDERS
  ADD CONSTRAINT ORDERS_FK4 FOREIGN KEY (
    DELIVERY_AGENCY_ID
  )
    REFERENCES DELIVERY_AGENCY(
      DELIVERY_AGENCY_ID
    );

DROP TABLE ORDERED_PRODUCTS;

DROP TABLE ORDERS;

CREATE TABLE ORDERS(
  ORDER_ID VARCHAR(255) NOT NULL,
  PATIENT_ID NUMBER NOT NULL,
  ORDER_DATE DATE DEFAULT SYSDATE NOT NULL,
  ORDER_STATUS VARCHAR(255) DEFAULT 'Pending' NOT NULL,
  DELIVERY_AGENCY_ID NUMBER NOT NULL,
  CONSTRAINT ORDERS_PK PRIMARY KEY (ORDER_ID),
  CONSTRAINT ORDERS_FK1 FOREIGN KEY (PATIENT_ID) REFERENCES PATIENT(PATIENT_ID),
  CONSTRAINT ORDERS_FK2 FOREIGN KEY (DELIVERY_AGENCY_ID) REFERENCES DELIVERY_AGENCY(DELIVERY_AGENCY_ID)
);

CREATE TABLE ORDERED_PRODUCTS(
  ORDER_ID VARCHAR(255) NOT NULL,
  PRODUCT_ID NUMBER NOT NULL,
  SHOP_ID NUMBER NOT NULL,
  ORDER_QUANTITY NUMBER NOT NULL,
  CONSTRAINT ORDERED_PRODUCTS_PK PRIMARY KEY (ORDER_ID, PRODUCT_ID, SHOP_ID),
  CONSTRAINT ORDERED_PRODUCTS_FK1 FOREIGN KEY (ORDER_ID) REFERENCES ORDERS(ORDER_ID),
  CONSTRAINT ORDERED_PRODUCTS_FK2 FOREIGN KEY (PRODUCT_ID) REFERENCES SUPPLY(PRODUCT_ID),
  CONSTRAINT ORDERED_PRODUCTS_FK3 FOREIGN KEY (SHOP_ID) REFERENCES SHOP(SHOP_ID)
);



SELECT
  O.ORDER_ID,
  PRODUCT_NAME,
  ORDER_QUANTITY,
  PATIENT_NAME,
  ORDER_DATE
FROM
  ORDERS           O,
  ORDERED_PRODUCTS OP,
  SUPPLY           S,
  PATIENT          P
WHERE
  O.ORDER_ID = OP.ORDER_ID
  AND OP.PRODUCT_ID = S.PRODUCT_ID
  AND O.PATIENT_ID = P.PATIENT_ID
  AND SHOP_ID = 5
  AND ORDER_STATUS = 'Pending';


  SELECT
  *
FROM
  ORDERS;


  ALTER TABLE PATIENT ADD PATIENT_IMAGE VARCHAR(255) DEFAULT 'https://res.cloudinary.com/dnn7v3kkw/image/upload/v1726489189/EyeCare/zm54mqyjywy0zegmxcyl.jpg' NOT NULL;

  ALTER TABLE PATIENT DROP COLUMN PATIENT_IMAGE;


UPDATE SUPPLY
SET
  PRODUCT_IMAGE = 'https://res.cloudinary.com/dnn7v3kkw/image/upload/v1726511594/EyeCare/wdr2njgue5veent4g54u.jpg';



  ALTER TABLE SUPPLY DROP COLUMN PRODUCT_DESCRIPTION;

  ALTER TABLE SUPPLY ADD PRODUCT_DESCRIPTION VARCHAR(4000) DEFAULT 'No Description' NOT NULL;


  ALTER TABLE PATIENT DROP COLUMN PATIENT_IMAGE;

  ALTER TABLE PATIENT ADD PATIENT_IMAGE VARCHAR(255) DEFAULT 'HTTPS://RES.CLOUDINARY.COM/DNN7V3KKW/IMAGE/UPLOAD/V1727238419/EYECARE/NEF8RHQYOOVQ7WCSODR0.JPG' NOT NULL;